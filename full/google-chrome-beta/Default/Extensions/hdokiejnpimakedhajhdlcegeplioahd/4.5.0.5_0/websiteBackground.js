function postacctsload(){var e,t={};for(e=0;e<g_sites.length;e++)g_sites[e].url=AES.hex2url(g_sites[e].url),void 0!==g_sites[e].username&&(g_sites[e].unencryptedUsername=lpmdec_acct(g_sites[e].username,!0,g_sites[e],g_shares)),g_SUPPORTSINGLE||(g_sites[e].pwch=!1),t[g_sites[e].aid]=g_sites[e];g_sites=t;var a={};for(e=0;e<g_securenotes.length;e++)a[g_securenotes[e].aid]=g_securenotes[e];g_securenotes=a;var r={};for(e=0;e<g_applications.length;e++)g_applications[e].appname=AES.hex2url(g_applications[e].appname),r[g_applications[e].appaid]=g_applications[e];for(g_applications=r,e=0;e<g_identities.length;e++)g_identities[e].deciname=lpdec(g_identities[e].iname);"function"==typeof get_data_handler&&get_data_handler()}function get_accts(){$.ajax({type:"POST",url:base_url+"getaccts.php",data:"mobile=1&b64=1&shap=1&includependingsharedfolders=1&includesharedfolderformfillprofiles=1&includeemergencyaccess=1&requestsrc=newvault&hasplugin="+encodeURIComponent(lpversion)+"&u="+encodeURIComponent(g_username_hash),dataType:"text",success:function(e){e=atob(e),g_sites=[],g_securenotes=[],g_prompts=[],g_formfills=[],g_identities=[],g_pendings=[],g_maxid=[],g_groups=[],g_prefoverrides=[],g_shares=[],g_applications=[],lp_attaches=[],g_attachversion=[],g_emer_sharers=[],g_emer_sharees=[],g_note_templates=[],g_reminders=[],g_pending_shares=[],g_blob_version={},parsemobile(e,e.length,100,0,postacctsload,g_sites,g_securenotes,g_prompts,g_formfills,g_identities,null,null,!0,!1,null,g_pendings,null,g_maxid,null,g_groups,g_prefoverrides,lp_rsaprivatekeyhex,g_shares,null,null,null,g_applications,lp_attaches,g_attachversion,null,null,null,g_emer_sharers,g_emer_sharees,null,g_note_templates,g_pending_shares,g_reminders,null,null,null,g_blob_version)}})}function process_icons(e,t){if(e&&(e=e.split(":"),e.length))for(var a=e[0],r=0,i=e.length;r+1<i;r+=2){var n=parseInt(e[r+1]);if(0===a.indexOf("lp")&&n>0){a=a.substring(2);var s=e[r+2].substring(0,n);t?g_bigicons[AES.hex2bin(a)]=s:g_icons[a]=s,a=e[r+2].substring(n)}}}function get_icons(e){$.ajax({type:"POST",url:base_url+"geticon.php",data:"big=1&versionchrome=1&username="+encodeURIComponent(g_username)+"&domain=all",dataType:"text",success:function(t){"latest"!=t&&"nodata"!=t&&process_icons(t,!0),e&&e()}})}function moveIntoSharedFolder(e,t,a,r,i,n,s,o){for(var l=(e&&t&&(e.id,t.id),void 0!==e&&e?e.sharekey:g_local_key),d=void 0!==t&&t?t.sharekey:g_local_key,p=void 0!==e&&e?e.id:g_uid,c=(void 0!==t&&t&&t.id,"cmd=uploadaccounts&username="+en(g_username)),_="",g=new Array,u={},f=0;f<a.length;++f){var h,m;"object"==typeof a[f]?(m=!1,h=a[f]):(h=getacct(a[f]),m=!0);var v=h.aid;if(null==h)return o.errorCallback(gs("Error: This folder has already been moved?")),!1;var y={};for(var b in h)h.hasOwnProperty(b)&&(y[b]=h[b]);var w,k=e?r[v].substr(e.decsharename.length+1):r[v];y.group=e?e.decsharename:"",""!=y.group&&""!=k&&(y.group+="\\"),y.group+=k,m&&(y.extra=lpmenc(lpmdec(h.extra,!0,d),!0,l)),is_application(h)?w="&appname"+f+"="+en(h.appname)+"&name"+f+"="+en(lpenc(h.name,l))+"&type"+f+"="+en("cr")+"&group"+f+"="+en(lpenc(k,l))+"&extra"+f+"="+en(crypto_btoa(y.extra))+"&script"+f+"="+en(h.script)+"&pwprotect"+f+"="+en(h.pwprotect?1:0)+"&wininfo"+f+"="+en(h.wininfo)+"&wintitle"+f+"="+en(h.wintitle)+"&exeversion"+f+"="+en(h.exeversion)+"&exehash"+f+"="+en(h.exehash)+"&fiid"+f+"="+en(h.fiid):(m&&(y.username=lpmenc(lpmdec(h.username,!0,d),!0,l)),m&&(y.password=lpmenc(lpmdec(h.password,!0,d),!0,l)),m&&(y.realm_data=lpmenc(lpmdec(h.realm_data,!0,d),!0,l)),w="&url"+f+"="+en(AES.url2hex(h.url))+"&username"+f+"="+en(crypto_btoa(y.username))+"&password"+f+"="+en(crypto_btoa(y.password))+"&name"+f+"="+en(lpenc(h.name,l))+"&type"+f+"="+en("cr")+"&grouping"+f+"="+en(lpenc(k,l))+"&extra"+f+"="+en(crypto_btoa(y.extra))+"&pwprotect"+f+"="+en(h.pwprotect?1:0)+"&realm"+f+"="+en(crypto_btoa(y.realm_data)),h.save_all&&(w+="&save_all"+f+"=1"),void 0!==h.basic_auth&&"1"==h.basic_auth&&(w+="&basic_auth"+f+"=1"),void 0!==h.notetype&&h.notetype&&h.notetype.length&&(w+="&notetype"+f+"="+en(h.notetype)),void 0!==h.template&&h.template&&h.template.length&&(w+="&template"+f+"="+en(h.template))),p!=g_uid?y.sharefolderid=p:void 0!==y.sharefolderid&&delete y.sharefolderid,void 0!==h.attachkey&&""!=h.attachkey&&(m&&(y.attachkey=lpenc(lpdec(h.attachkey,d),l)),w+="&attachkey"+f+"="+en(y.attachkey)),w+="&origaid"+f+"="+en(v);var x="";y.fields=new Array;for(var b=0;b<h.fields.length;b++){y.fields[b]={};for(var S in h.fields[b])h.fields[b].hasOwnProperty(S)&&(y.fields[b][S]=h.fields[b][S]);var C=h.fields[b].value,I=h.fields[b].type;is_application(h)||"text"==I||"email"==I||"tel"==I||"password"==I||"textarea"==I||"hidden"==I?(m&&(y.fields[b].value=lpmenc(lpmdec(C,!0,d),!0,l)),C=crypto_btoa(y.fields[b].value)):"checkbox"!=I&&"radio"!=I||(C+=h.fields[b].checked?"-1":"-0"),is_application(h)?x+="&fields"+f+"id"+b+"="+en(h.fields[b].id)+"&fields"+f+"type"+b+"="+en(h.fields[b].type)+"&fields"+f+"value"+b+"="+en(C):x+="&fields"+f+"name"+b+"="+en(h.fields[b].name)+"&fields"+f+"type"+b+"="+en(h.fields[b].type)+"&fields"+f+"value"+b+"="+en(C)+"&fields"+f+"formname"+b+"="+en(void 0===h.fields[b].formname?"":h.fields[b].formname)}u[v]=y,c+=w,c+=x,_+=en(v)+",",g[g.length]=v}return c+="&sharedfolderid="+en(p),c+="&todelete="+_,null!=typeof e&&t&&(c+="&origsharedfolderid="+en(t.id)),4==(4&g_loglogins)&&(c+="&reportname="+en(h.name)),8==(8&g_loglogins)&&(c+="&reportusername="+en(h.unencryptedUsername)),$.ajax({type:"POST",url:base_url+"lastpass/api.php",data:c,dataType:"xml",success:function(e){var t=e.documentElement.getElementsByTagName("result");if(t.length>0){for(var r=!0,i=0;i<a.length;++i){var n="object"==typeof a[i]?a[i]:getacct(a[i]),s=n.aid,l=u[s];if(n&&l)if(is_application(n)){if(lp_in_array(s,g)&&delete g_applications[get_appaid(s)],l.appaid=t[0].getAttribute("aidmap"+s),!l.appaid){r=!1;break}l.appaid=get_appaid(l.appaid),g_applications[l.appaid]=l}else{lp_gettld_url(n.url);if(lp_in_array(s,g)&&("http://sn"==n.url?delete g_securenotes[s]:delete g_sites[s]),l.aid=t[0].getAttribute("aidmap"+s),!l.aid){r=!1;break}"http://sn"==l.url?g_securenotes[l.aid]=l:g_sites[l.aid]=l;for(var d in lp_attaches)if(lp_attaches.hasOwnProperty(d)&&lp_attaches[d].parent==s){var p=lp_attaches[d],c=new Array;for(var _ in p)p.hasOwnProperty(_)&&(c[_]=p[_]);var f=p.id;if(c.id=t[0].getAttribute("attachidmap"+f),!c.id){r=!1;break}c.parent=l.aid,lp_in_array(s,g)?lp_attaches[d]=c:lp_attaches[lp_attaches.length]=c}if(!r)break}}r&&o&&o.successCallback&&o.successCallback(u)}else{var t=e.documentElement.getAttribute("rc");if("SERVER_uploadfailed"==t){var h=gs("Your Shared Folder action failed. Please check your permissions before trying again");o&&o.errorCallback&&o.errorCallback(h)}else if("SERVER_sharedfolder_passwordsmustbehidden"==t){var h=gs("Your do not have permission to view this account password so you cannot move it from the current Shared Folder.");o&&o.errorCallback&&o.errorCallback(h)}else{var h=gs("Your Shared Folder action failed.");o&&o.errorCallback&&o.errorCallback(h)}}get_accts()},error:function(){o&&o.errorCallback&&o.errorCallback(gs("An error occurred"))}}),!0}function refreshGroupNames(){}lploggedin=!0,g_local_accts_version=-1,g_server_accts_version=-1,g_identities=[],g_formfills=[],g_pendings=[],base_url="",g_sites={},g_securenotes={},g_enterpriseuser=0,g_enterprisemodel=0,g_enterpriseuserrole=null,g_iscompanyadmin=0,g_premium_exp=0,g_applications={},g_shares=[],g_username=null,lp_username=null,g_username_hash=null,g_prompts={},g_maxid=[],g_groups={},g_prefoverrides={},lp_attaches=[],g_attachversion=[],g_emer_sharers=[],g_emer_sharees=[],g_note_templates=[],g_reminders=[],lpversion="4.0",g_uid=null,g_icons=[],g_bigicons=[],g_identity="undefined"!=typeof iid&&iid?iid:Preferences.get("identity"),g_nofolder_feature_enabled=!1,g_basicauth_feature_enabled=!1,g_blob_version={},get_personal_linked=function(){for(var e=0;e<g_shares.length;e++)if(void 0!==g_shares[e].associative&&1==g_shares[e].associative)return g_shares[e].id;return""},get_securityChallengeScore=function(e){e(null)},getbigicon=function(e){var t=lp_gettld_url(e);return void 0!==g_bigicons[t]?"data:image/png;base64,"+g_bigicons[t]:null},get_method_async=function(e){e()},geticonurlfromrecord=function(e,t){return is_application(e)?"lps lpapp"+e.fiid:"lps lp"+e.aid},unlock_plug2web=function(){g_plug2web_last_initiated=parseInt((new Date).getTime()/1e3)},get_last_reprompt_time=function(){return"undefined"==typeof last_reprompt_time&&(last_reprompt_time=Preferences.get("lastreprompttime")),last_reprompt_time},set_last_reprompt_time=function(){last_reprompt_time=(new Date).getTime(),Preferences.set("lastreprompttime",last_reprompt_time)},get_key_iterations=function(){return 5e3},function(){var e={};lpevent=function(t){t="w"+t,e[t]=e.hasOwnProperty(t)?e[t]+1:1},setInterval(function(){if(g_prompts.improve){var t=!1;for(var a in e){t=!0;break}t&&LPServer.xmlRequest({url:"poll_server.php",data:e}),e={}}},1e4)}(),processCS=function(e,t,a){if("ipcgetdata"==t.cmd&&"undefined"!=typeof g_plug2web_last_initiated&&g_plug2web_last_initiated>=parseInt((new Date).getTime()/1e3)-20){var r=lpParseUri(t.url),i=r.directory.replace(new RegExp("^/~[^/]*"),""),n=r.file.replace(new RegExp("#"),"");if("/"==i&&"acctsiframe.php"==n){var s={cmd:"ipcgotdata",username:g_username,key:btoa(g_local_key),version:lpversion,identity:g_identity,iterations:get_key_iterations(g_username)};t.callback(s)}}},openimport=function(){window.open(base_url+"import.php")},openexport=function(){window.open(base_url+"export.php")},openseccheck=function(){window.open(base_url+"?securitychallenge=1&lpnorefresh=1")},openentconsole=function(){window.open(base_url+"company/#/dashboard")},openFamilyConsole=function(){window.open(base_url+"family/")},loggedOut=function(){send_website_event("logoff"),setTimeout(function(){top.location.href=base_url+"logout.php?token="+g_token},500)},get_saved_logins=function(){},have_binary=function(){return canopensaveattach},install_binary=function(){window.open(base_url+"installer/")},addAttach=function(e){addattach_callback=e,attachkey=SHA256(get_random_password()),send_website_event("getattach",attachkey)},openAttach=function(e,t,a){for(var r=0;r<lp_attaches.length;r++)if(lp_attaches[r].id==t){if(void 0===lp_attaches[r].data||""===lp_attaches[r].data){var i={getattach:lp_attaches[r].storagekey};return void 0!==g_securenotes[e].sharefolderid&&(i.sharedfolderid=g_securenotes[e].sharefolderid),void $.ajax({global:!1,type:"POST",cache:!1,dataType:"json",url:"show_website.php",data:i,success:function(i){""!=i&&(lp_attaches[r].data=i,openAttach(e,t,a))},failure:function(e){alert("error")}})}send_website_event("openattach",lpdec_acct(g_securenotes[e].attachkey,g_securenotes[e],g_shares),lp_attaches[r].data,lp_attaches[r].mimetype)}},exportAttachment=function(e,t,a){for(var r=0;r<lp_attaches.length;r++)if(lp_attaches[r].id==t){if(void 0===lp_attaches[r].data||""===lp_attaches[r].data){var i={getattach:lp_attaches[r].storagekey};return void 0!==g_securenotes[e].sharefolderid&&(i.sharedfolderid=g_securenotes[e].sharefolderid),void $.ajax({global:!1,type:"POST",cache:!1,dataType:"json",url:"show_website.php",data:i,success:function(i){""!=i&&(lp_attaches[r].data=i,exportAttachment(e,t,a))},failure:function(e){alert("error")}})}send_website_event("saveattach",lpdec_acct(g_securenotes[e].attachkey,g_securenotes[e],g_shares),lp_attaches[r].data,lp_attaches[r].mimetype)}},can_copy_to_clipboard=function(){return!1},fastEncryptAttachments=function(e,t,a){var r=[];for(var i in t)t.hasOwnProperty(i)&&void 0!==t[i]&&r.push({id:t[i].id,data:enccbc(t[i].bytes,e)});a(r)},gotourl=function(e){if(g_sites[e].url){var t=g_sites[e].url;t.match(/^[a-z]+?\:\/\//i)||(t="http://"+t),window.open(t)}},increment_local_accts_version=function(){g_local_accts_version++},refreshsites=function(){get_accts()},request_native_messaging=function(){send_website_event("request_native_messaging")},rewritelocalfile=function(){},editAid=function(e,t,a,r){r&&send_website_event("auto_pwchg",e,"0")},switch_identity=function(e){send_website_event("switchidentity",e),g_identity=""+e,Preferences.set("identity",g_identity),document.cookie="iid="+encodeURIComponent(g_identity)},launch=function(e){g_hasplugin?(document[g_manualformname].aid.value=e,document[g_manualformname].submitbtn.click()):pa(function(){window.open(base_url+"launch.php?id="+encodeURIComponent(e)+"&shareid="+encodeURIComponent(void 0!==g_sites[e].sharefolderid?g_sites[e].sharefolderid:0)+"&method=web&token="+g_token)},g_prompts.login_site_prompt||g_sites[e].pwprotect)},launchApp=function(e){launch("app"+e)},check_ident_aid=function(e){if(""===g_identity)return!0;for(var t=0;t<g_identities.length&&g_identities[t].iid!=g_identity;t++);if(t>=g_identities.length)return!1;var a=g_identities[t];return void 0===a.aidarr&&(a.aidarr=a.aids.split(",")),lp_in_array(e,a.aidarr)},check_ident_appaid=function(e){if(""===g_identity)return!0;for(var t=0;t<g_identities.length&&g_identities[t].iid!=g_identity;t++);if(t>=g_identities.length)return!1;var a=g_identities[t];return void 0===a.appaidarr&&(a.appaidarr=a.appaids.split(",")),lp_in_array(e,a.appaidarr)},openall=function(e,t){var a=[],r=!1;for(var i in g_sites)if(check_ident_aid(i)){var n=g_sites[i];n.group==e&&"http://group"!=n.url&&(a.push(n),r=r||n.pwprotect)}if(0!==a.length){if(!t&&(r||g_prompts.login_site_prompt))return void pa(function(){openall(e,!0)},!0);for(var s=0;s<a.length;s++)window.open(a[s].url)}},openAllSites=function(e){for(var t=0;t<e.length;t++)window.open(e[t].url)},openfavorites=function(e,t){var a=[],r=!1;for(var i in g_sites){var n=g_sites[i];check_ident_aid(i)&&"1"==n.fav&&(a.push(n),r=r||n.pwprotect)}if(0===a.length)return void alert(StringUtils.translate("You do not have any Favorites yet."));if(!e&&(r||g_prompts.login_site_prompt))return void pa(function(){openfavorites(!0)},!0);for(var s=0;s<a.length;s++)window.open(a[s].url);var o={};void 0!==t&&(o={source:t}),sendLpImprove("openfavorites",o)},createNewAcct=function(){return{aid:"",name:"",group:"",url:"",tld:"",extra:"",fav:"0",sharedfromuid:"",username:"",unencryptedUsername:"",password:"",pwprotect:0,genpw:0,sn:0,last_touch:lp_get_gmt_timestamp(),autologin:0,never_autofill:0,realm_data:"",fiid:"",custom_js:"",submit_id:"",captcha_id:"",urid:"0",basic_auth:"0",method:"",action:"",individualshare:!1,fields:[]}},addEmptyGroup=function(e,t,a){var r=issharedfolder(g_shares,e);if(checkreadonly(r)){var i=!1===r?g_local_key:r.sharekey,n=e;if(r){if(!checkreadonly(r))return;n=e.substr(r.decsharename.length+1)}var s=createNewAcct();s.url="http://group",s.group=e,s.aid="0";var o="ajax=1&extjs=1&name=&url="+encodeURIComponent(AES.url2hex(s.url))+"&grouping="+encodeURIComponent(lpenc(n,i))+"&username=&password=&extra=&aid=0&openid_url=&isbookmark=0";o+=!1===r?"":"&sharedfolderid="+en(r.id),o+=get_identity_param(),o+="&token="+g_token,$.ajax({type:"POST",url:base_url+"show_website.php",data:o,dataType:"text",success:function(e){var a=$(jQuery.parseXML(e)).find("result");a.length&&(s.aid=a.attr("aid"),add_ident_aid(s.aid),t(s),g_sites[s.aid]=s)},failure:a})}},checkmultiplefolders=function(e){for(var t=!1,a=null,r=!0,i=0;i<e.length;i++){var n=e[i],s=get_record(n);if(s){var o=issharedfolder(g_shares,s.group);if(o){if(t){r=!1;break}if(null===a)a=o.decsharename;else if(a!=o.decsharename){r=!1;break}}else{if(null!==a){r=!1;break}t=!0}}}return r||alert(StringUtils.translate("Sorry, you cannot perform this operation on a mix of shared and non-shared folders, or multiple shared folders at once.")),r},get_record=function(e){return void 0===e?null:is_application(e)?g_applications[e.substring(3)]:"undefined"!=typeof g_sites&&void 0!==g_sites[e]?g_sites[e]:"undefined"!=typeof g_securenotes&&void 0!==g_securenotes[e]?g_securenotes[e]:null},deleteAid=function(e,t,a,r,i){var n=e.split(",");if(!checkmultiplefolders(n))return!1;for(var s="",o=0,l=0;l<n.length;l++){var d=n[l];if(is_application(id)){if(!check_ident_appaid(d))continue}else if(!check_ident_aid(d))continue;var p=get_record(d);if(p){if(s+=(""===s?"":",")+d,void 0!==p.sharefolderid){o=p.sharefolderid;var c=issharedfolder(g_shares,p.group);if(!checkreadonly(c))return!1}is_application(p)&&void 0!==g_applications[p.appaid]?delete g_applications[p.appaid]:void 0!==g_sites[d]?delete g_sites[d]:void 0!==g_securenotes[d]&&delete g_securenotes[d]}}if(""===s)return!1;var _="ajax=1&extjs=1&delete=1&aid="+en(s);return _+=get_identity_param(),0!==o&&(_+="&sharedfolderid="+en(o)),_+="&token="+g_token,$.ajax({type:"POST",url:base_url+"show_website.php",data:_,dataType:"text"}),i&&i(),!0},get_identity_param=function(){return"&iid="+encodeURIComponent(g_identity)},deleteGroup=function(e,t,a){var r,n=[];for(r in g_sites)g_sites[i].group===e&&n.push(r);for(r in g_securenotes)g_securenotes[i].group===e&&n.push(r);for(r in g_applications)g_applications[i].group===e&&n.push(r);return deleteAid(n.join(","),t,!1,!0,a)},deleteformfill=function(e,t,a,r,i,n,s){var o,l=!1;for(o=0;o<g_formfills.length;o++)if(g_formfills[o].ffid==e){l=issharedfolder(g_shares,void 0!==g_formfills[o].group?g_formfills[o].group:""),g_formfills.splice(o,1);break}var d="deleteext=1&ffid="+encodeURIComponent(e);return d+=!1===l?"":"&sharedfolderid="+encodeURIComponent(l.id),d+=get_identity_param(),d+="&method="+encodeURIComponent(getBG().get_method()),d+="&token="+g_token,d+="&src=website",s&&(d+="&source="+encodeURIComponent(s)),$.ajax({type:"POST",url:base_url+"formfill.php",data:d,dataType:"text",success:i,failure:n}),!0},moveSelectedToGroup=function(e,t,a,r,i){a=a||{},a.successCallback=r,a.errorCallback=i;var n=void 0!==a.skipConfirm&&a.skipConfirm,s=t.split(","),o=issharedfolder(g_shares,e),l=null;if(checkreadonly(o)){for(var d=!1,p=0;p<s.length;p++){var c=s[p],_=get_record(c);if(l=issharedfolder(g_shares,_.group),!checkreadonly(l))return;if(!checkmove(o,l))return;!o&&!l||o&&l&&o.id===l.id||(d=!0)}if(d){for(var g=[],p=0;p<s.length;p++)g[s[p]]=e;return void moveIntoSharedFolder(o,l,s,g,!1,!1,n,a)}var u=[],f=[];if(e===StringUtils.translate("favorites"))for(var p=0;p<s.length;p++){var h=get_record(s[p]);h&&"0"==h.fav&&(u[u.length]=s[p])}(s.length>0||u.length>0||f.length>0)&&changeGroupAndFavorites(s,u,f,e,o,a)}},changeGroupAndFavorites=function(e,t,a,r,i,n){for(var s="",o="",l="",d=[],p=0;p<e.length;p++){var c=e[p],_=get_record(c);_&&r!=StringUtils.translate("favorites")&&(d[d.length]=c,_.group=r,s+=l+c,l=",")}l="";for(var p=0;p<t.length;p++){var c=t[p],_=get_record(c);_&&(d[d.length]=c,_.fav="1",o+=l+c,l=",")}g_local_accts_version++,g_server_accts_version++,rewritelocalfile(),n&&n.successCallback&&n.successCallback();var g=!1===i?g_local_key:i.sharekey,u=r;i&&(u=r.substr(i.decsharename.length+1));var f="aids="+encodeURIComponent(s)+"&newfavaids="+encodeURIComponent(o)+"&oldfavaids="+encodeURIComponent("")+"&newgrp="+encodeURIComponent(lpenc(u,g))+"&xml=1";f+=0==i?"":"&sharedfolderid="+en(i.id),g_token&&(f+="&token="+g_token),$.ajax({type:"POST",url:base_url+"groups.php",data:f,dataType:"text"})},renameGroup=function(e,t){if(e!=StringUtils.translate("favorites")){var a=issharedfolder(g_shares,e);if(0!=a&&a.decsharename==e)return void alertfrombg("You cannot rename a top level Shared folder");var r=issharedfolder(g_shares,t);if(checkmove(r,a)&&checkreadonly(r)&&checkreadonly(a)){var i=0==r?g_local_key:r.sharekey,n=t;if(r&&(n=t.substr(r.decsharename.length+1)),r||a){var s=[],o=[],l=[g_sites,g_securenotes,g_applications];r&&t.substr(r.decsharename.length+1);for(var d in l){var p=l[d];for(var c in p)if(p.hasOwnProperty(c)){var _=p[c];if(_.group==e||0==_.group.indexOf(e+"\\\\")){s[s.length]=get_record_id(_);var g=t;_.group!=e&&_.group.indexOf("\\\\")>0&&(g=t+_.group.substr(_.group.indexOf("\\\\"))),o[get_record_id(_)]=g}}}return void moveIntoSharedFolder(r,a,s,o,!1,!1,!1)}var l=[g_sites,g_securenotes,g_applications],u=[],f=[],h=[];for(var d in l){var p=l[d];for(var c in p)if(p.hasOwnProperty(c)){var _=p[c];if(_.group==e){_.group=t,void 0===u[e]?(h[h.length]=e,f[e]=get_record_id(_)):f[e]+=","+get_record_id(_);var n=t;r&&(n=n.substr(r.decsharename.length+1)),u[e]=n}else if(0==_.group.indexOf(e+"\\\\")){var m=_.group;_.group=_.group.replace(e+"\\\\",t+"\\\\"),void 0===u[m]?(h[h.length]=m,f[m]=get_record_id(_)):f[m]+=","+get_record_id(_);var n=_.group;r&&(n=n.substr(r.decsharename.length+1)),u[m]=n}}}g_local_accts_version++,rewritelocalfile();for(var v="xml=1",y=0;y<h.length;y++)v+="&ids"+y+"="+encodeURIComponent(f[h[y]])+"&newgrp"+y+"="+encodeURIComponent(lpenc(u[h[y]],i));v+=0==r?"":"&sharedfolderid="+en(r.id),g_token&&(v+="&token="+g_token),$.ajax({type:"POST",url:base_url+"groups.php",data:v,dataType:"text"})}}},get_record_id=function(e){return is_application(e)?"app"+e.appaid:e.aid},is_application=function(e){return"string"==typeof e?0===e.indexOf("app"):e&&void 0!==e.appaid},getBG=function(){return this},saveSite=function(e,t,a,r){e+="&method="+encodeURIComponent(getBG().get_method()),e+="&auto=1"+get_identity_param(),e+="&token="+g_token,t.postdata=e,t.posturl=base_url+(is_application(t)?"addapp.php":"show_website.php"),$.ajax({type:"POST",url:t.posturl,data:e,dataType:"text",success:function(e){e=$(jQuery.parseXML(e));var i=e.find("result");if(i.length){0==t.aid&&(t.aid=i.attr("aid"),add_ident_aid(t.aid));var n=i.attr("attacherror");n&&""!=n&&alert(n);for(var s=0,o=Array();null!=i.attr("att_"+s);)o[i.attr("att_"+s)]=Array(),o[i.attr("att_"+s)].key=i.attr("attstorekey_"+s),o[i.attr("att_"+s)].size=i.attr("attsize_"+s),s++;if(void 0!==t.attacharraychanges&&(!n||""==n)){if(void 0!==t.attacharraychanges.add)for(var l in t.attacharraychanges.add)t.attacharraychanges.add.hasOwnProperty(l);applyattacharraychanges(t.attacharraychanges)}t.sn?g_securenotes[t.aid]=t:g_sites[t.aid]=t,a(t)}else{var d=e.find("error");d.length&&r(d.attr("response"))}},failure:r})},saveFields=function(e,t,a,r,i){t+="&method="+encodeURIComponent(getBG().get_method()),t+="&token="+g_token,$.ajax({type:"POST",url:base_url+"fields.php?"+e,data:t,dataType:"text",success:r,failure:i})},changePassword=function(e,t,a,r,i){for(var n=[],s=0,o=0;o<t.length;o++)if(g_sites[t[o]]){var l=lpmdec_acct(g_sites[t[o]].password,!0,g_sites[t[o]],g_shares);if(l!=e&&(n[n.length]=t[o],g_sites[t[o]].password=lpmenc_acct(e,!0,g_sites[t[o]],g_shares),g_sites[t[o]].fields))for(var d=0;d<g_sites[t[o]].fields.length;d++)"password"==g_sites[t[o]].fields[d].type&&lpmdec_acct(g_sites[t[o]].fields[d].value,!0,g_sites[t[o]],g_shares)==l&&(g_sites[t[o]].fields[d].value=g_sites[t[o]].password);void 0!==g_sites[t[o]].sharefolderid&&(s=g_sites[t[o]].sharefolderid)}if(t=n,0!==t.length){for(var p="xml=1",c=[],o=0;o<t.length;o++){var _=o>0?o:"";p+="&username"+_+"=dummy",p+="&password"+_+"="+encodeURIComponent(lpenc_acct(e,g_sites[t[o]],g_shares)),p+="&id"+_+"="+encodeURIComponent(t[o]);try{lp_in_array(g_sites[t[o]].tld,c)||(c[c.length]=g_sites[t[o]].tld)}catch(e){}}try{for(var o in g_sites)if(g_sites[o].genpw&&lp_in_array(g_sites[o].tld,c)&&lpmdec_acct(g_sites[o].password,!0,g_sites[o],g_shares)==e){p+="&delgenpwaid="+encodeURIComponent(o);break}}catch(e){}0!=s&&(p+="&sharedfolderid="+en(s)),void 0!==a&&a&&(p+="&autochange=1");var g={};g.aid=0,g.postdata=p,g.url=base_url+"change_pw.php",g.handler=r,g.param={aid:g.aid,postdata:g.postdata,url:g.url,handler:g.handler},g.successCallback=r,$.ajax({type:"POST",url:g.url,data:g.postdata,dataType:"text",success:function(e){var t=$(jQuery.parseXML(e)).find("ok");if(t.length)for(var a="";t.attr("id"+a);){var i=g_sites[t.attr("id"+a)],n=crypto_atob(t.attr("newpassword"+a)),s=crypto_atob(t.attr("oldpassword"+a));if(i.password=n,i.fields)for(var o=0;o<i.fields.length;++o){var l=i.fields[o];"password"!=l.type||l.value!=s&&lpmdec_acct(l.value,!0,i,g_shares)!=lpmdec_acct(s,!0,i,g_shares)||(l.value=n)}a=""===a?1:++a}r()},failure:i})}},addeditformfill=function(e,t,a,r){var i="";i+="&method="+encodeURIComponent(getBG().get_method());var n;for(n in e)i+=(""==i?"":"&")+n+"="+en(e[n]);var s=!1;return void 0!==t.group&&""!=t.group&&(s=issharedfolder(g_shares,t.group)),i+=0==s?"":"&sharedfolderid="+en(s.id),i+=get_identity_param(),i+="&token="+g_token,i+="&src=website",$.ajax({type:"POST",url:base_url+"formfill.php",data:i,dataType:"text",success:function(e){var r=$(jQuery.parseXML(e)).find("result");if(r.length){var i=(r.attr("msg"),r.attr("ffid"));add_ident_ffid(i);var n,s=r.attr("cfids"),o=(r.attr("accts_version"),[]),l=""==s?[]:s.split(","),d=0;for(n=1;void 0!==t["customfield"+n+"cfid"];++n){var p={};p.cfid=0!=t["customfield"+n+"cfid"]?t["customfield"+n+"cfid"]:d<l.length?l[d++]:0,p.text=t["customfield"+n+"text"],p.value=t["customfield"+n+"value"],p.alttext=t["customfield"+n+"alttext"],""==p.text&&""==p.value&&""==p.alttext||o.push(p)}var c=t.cmd;for(delete t.cmd,delete t.deleteext,n=1;void 0!==t["customfield"+n+"cfid"];++n)delete t["customfield"+n+"cfid"],delete t["customfield"+n+"text"],delete t["customfield"+n+"value"],delete t["customfield"+n+"alttext"];if(t.custom_fields=o,"add"==c)t.ffid=i,g_formfills.push(t);else for(n=0;n<g_formfills.length;++n)if(i==g_formfills[n].ffid){g_formfills[n]=t;break}a&&a(t)}},failure:r}),!0},add_ident_aid=function(e){if(g_identity){for(var t=null,a=0;a<g_identities.length;a++)if(g_identities[a].iid===g_identity){t=g_identities[a];break}t&&(t.aids&&(t.aids+=","),t.aids+=e,t.aidarr=t.aids.split(","))}},add_ident_ffid=function(e){if(g_identity){for(var t=null,a=0;a<g_identities.length;a++)if(g_identities[a].iid==g_identity){t=g_identities[a];break}t&&(t.ffids&&(t.ffids+=","),t.ffids+=e,t.ffidarr=t.ffids.split(","))}},db_prepend=function(e){return e},localStorage_setItem=function(e,t){try{return localStorage.setItem(e,t),!0}catch(e){return!1}},localStorage_getItem=function(e){try{return localStorage.getItem(e)}catch(e){return null}},openURL=function(e){window.open(e)},canLaunchApplication=function(){return!1},singlefactor_reprompt=function(e,t,a){e()},isOffline=function(){return!1},get_method=function(){return"web"},lpReportError=function(){return errorCount=0,function(e){!0===g_prompts.improve&&(++errorCount>100||$.ajax({url:base_url+"error.php",type:"POST",data:{msg:"error: website("+lpversion+") errors("+errorCount+"): "+e}}))}}(),loglogin=function(e){if(g_loglogins){var t=get_record(e);if(t){var a=issharedfolder(g_shares,t.group);if(a&&a.id===get_personal_linked())return;var r={id:e,method:get_method()};a&&(r.sharedfolderid=a.id),t&&(Policies.logUrlEnabled()&&"http://sn"!==t.url&&(r.u=AES.url2hex(t.url)),Policies.logNameEnabled()&&(r.n=AES.url2hex(t.name)),Policies.logUserNameEnabled()&&t.unencryptedUsername&&(r.un=AES.url2hex(t.unencryptedUsername))),$.ajax({url:base_url+"loglogin.php",type:"POST",data:r})}}},sendLpImprove=function(e,t){"object"==typeof LastpassApiHelper&&"function"==typeof LastpassApiHelper.sendLpImprove&&LastpassApiHelper.sendLpImprove(e,g_lpImprove,t)},VaultToggle={toggleVault3_0:function(){}};