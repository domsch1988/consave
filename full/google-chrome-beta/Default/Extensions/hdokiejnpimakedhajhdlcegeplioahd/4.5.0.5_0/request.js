LPRequest={},function(e){var t={},r=function(){for(var e in t)clearTimeout(t[e]);t={}};Topics.get(Topics.REFRESH_DATA).subscribe(r),Topics.get(Topics.CLEAR_DATA).subscribe(r),e.getNewRequestID=function(){var e=0;return function(){return++e}}(),e.makeRequest=function(){var r=function(e,t){return function(){for(var r=0,s=e.length;r<s;++r)e[r].unlock();t&&t.apply(window,arguments)}},s=function(e,t){return function(){for(var r=0,s=e.length;r<s;++r)e[r].lockForUpdate();t.apply(window,arguments)}},n=function(e,r){var s=function(s){try{Topics.get(Topics.REQUEST_SUCCESS).publish(e),r&&(clearTimeout(r),delete t[e.requestID]),s&&Topics.get(Topics.SUCCESS).publish(s)}catch(e){LPPlatform.logException(e)}};return e&&e.success?function(){var t=arguments,r=e.successMessage;t.length>0&&"string"==typeof t[0]&&(r=void 0===r?t[0]:r,t=Array.prototype.slice.call(t,1));try{e.success.apply(window,t)}catch(e){LPPlatform.logException(e)}s(r)}:s},o=function(e,r){var s=function(s){try{switch(s){case"notoken":s=Strings.translateString("No token was provided. Request could not be completed.");break;case"session_expired":s=Strings.translateString("ErrorSessionMsg");break;case"not_allowed":s=Strings.translateString("Your Shared Folder action failed. Please check your permissions before trying again");break;case"invalidxml":s=Strings.translateString("Invalid XML response.");break;case"invalidjson":s=Strings.translateString("Invalid JSON response.");break;case"offline":s=Strings.translateString("This request cannot be completed because you are currently offline.");break;case"policy":s=Strings.translateString("Sorry, this operation is not allowed by a policy.");break;case void 0:s=Strings.Vault.UNEXPECTED_ERROR}Topics.get(Topics.ERROR).publish(s),Topics.get(Topics.REQUEST_ERROR).publish(e),r&&(clearTimeout(r),delete t[e.requestID])}catch(e){LPPlatform.logException(e)}};return e&&e.error?function(t){s(t),e.error()}:s},i=function(e){return function(t){Topics.get(Topics.REQUEST_STATUS).publish(t,e)}};return function(a,c){if(c.confirm){var u=c.confirm;return delete c.confirm,u.handler=function(){e.makeRequest(a,c)},void Topics.get(Topics.CONFIRM).publish(u)}c.requestID=e.getNewRequestID();var l=null;if(LPTools.getOption(c,"showTimeWarning",!0)&&(l=setTimeout(function(){T(Strings.translateString("Sorry, this request is taking longer than normal."))},3e4),t[c.requestID]=l),c.items&&LPTools.getOption(c,"lockItems",!1)){var p=c.items;p instanceof Array||(p=[p]),a=s(p,a),c.success=r(p,c.success),c.error=r(p,c.error),c.confirm&&(c.confirm.closeHandler=r(p))}var g,f=n(c,l),T=o(c,l);c.params?g=[{params:c.params,requestArgs:c.requestArgs,success:f,error:T,status:c.status?i(c):null}]:(g=LPTools.getOption(c,"parameters",[]),g instanceof Array||(g=[g]),g.push(f),g.push(T)),Topics.get(Topics.REQUEST_START).publish(c);try{a.apply(window,g)}catch(e){LPPlatform.logException(e),T(Strings.Vault.UNEXPECTED_ERROR)}}}(),e.makeDataRequest=function(t,r){e.makeRequest(t,$.extend(!0,r,{dialogRequest:!1}))},e.makeUpdateRequest=function(t,r){e.makeRequest(t,$.extend(!0,r,{requestSuccessOptions:{incrementAccountsVersion:!0}}))},e.makeLockItemUpdateRequest=function(e,t){this.makeUpdateRequest(e,$.extend(t,{lockItems:!0}))}}(LPRequest);