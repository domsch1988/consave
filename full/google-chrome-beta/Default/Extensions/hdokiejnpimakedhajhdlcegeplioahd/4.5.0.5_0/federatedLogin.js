var FederatedLogin=function(){function t(t,e,n){const a=XOR(atob(e.k1),atob(e.k2)),o=btoa(binarySHA256(a));LPServer.lmiapi.jsonRequest({url:"lmiapi/login/getLocalKeyPart",type:"POST",data:{username:t,keyHash:o,authSessionId:e.authSessionId},success:function(t){n(t.localKey)},error:function(t){console.error(t)}})}function e(t,e,n){LPServer.jsonRequest({baseUrl:e,url:"/auth/saml2/getauthinfo/"+t,type:"GET",success:function(t){n(t)},error:function(t){console.error(t)}})}function n(t,e,n){var a=function(t){var e={},a=t.tabDetails.tabID,o=LPPlatform.onTabUpdated(function(t){if(a===t.tabDetails.tabID){if(e[t.tabDetails.tabID]!==t.tabDetails.tabURL&&-1!==t.tabDetails.tabURL.indexOf("/auth/saml2/success/")){const r=t.tabDetails.tabURL.substring(t.tabDetails.tabURL.length-67);t.close(),o(),n(r)}e[t.tabDetails.tabID]=t.tabDetails.tabURL}})};LPPlatform.openTab({url:t+"/auth/saml2/"+e,loadHandler:a})}function a(t,e){var n,a=Preferences.get(t);a&&(n=JSON.parse(a)),n&&n.queryDate>Date.now()-6e4?e(n):LPServer.jsonRequest({url:"lmiapi/login/type",CSRFToken:!1,type:"GET",data:{username:t},success:function(n){n.queryDate=Date.now(),Preferences.set(t,JSON.stringify(n)),e(n)},error:function(t){console.error(t)}})}function o(t,e){return btoa(binarySHA256(XOR(XOR(atob(t.k1),atob(t.k2)),atob(e))))}function r(t){return void 0!==t&&""!==t&&null!==check_email(t)}function i(t){return 0!==t}function s(s,u,c){r(s)&&a(s,function(a){var r=i(a.type);c(r),r&&n(a.IdentityProviderURL,a.IdentityProviderGUID,function(n){e(n,a.IdentityProviderURL,function(e){t(s,e,function(t){LP_do_login(s,o(e,t),u)})})})})}function u(t,e){r(t)?c[t]?e(i(c[t].type)):a(t,function(n){c[t]=n,e(i(n.type))}):e(!1)}var c={};return{initiateFederatedLogin:s,isUserFederated:u}}();